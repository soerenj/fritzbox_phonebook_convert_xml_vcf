<!DOCTYPE html>
<html>
<head>
<title>Convert Fritzbox Phonebook Telefonbuch xml â†” vcf (vcard) | webservice online</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="title" lang="en" content="Convert Fritzbox Phonebook | webservice" />
<meta name="title" lang="de" content="Umwandlung Fritzbox Telefonbuch | web-dienst" />
<meta name="application-name" lang="en" content="Converter: Fritzbox Phonebook xml â†” vcf (vcard)" />
<meta name="application-name" lang="de" content="Umwandler: Fritzbox Telefonbuch  xml â†” vcf (vcard)" />
<meta name="description" lang="en" content="Online converter for phonebook files from router Fritzbox .xml : between .xml â†” to / from .vcf (vcard) and backwards" />
<meta name="description" lang="de" content="Online konvertierung umwandlung vom Telefonbuch der Fritzbox (.xml Datei) : zwischen .xml â†” von / nach .vcf (vcard) und zurÃ¼ck." />
<meta property="og:title" lang="en" content="Convert Fritzbox Phonebook | webservice" />
<meta property="og:title" lang="de" content="Umwandlung Fritzbox Telefonbuch | web-dienst" />
<meta property="og:description" lang="en" content="Online converter for phonebook files from router Fritzbox .xml : between .xml â†” to / from .vcf (vcard) and backwards" />
<meta property="og:description" lang="de" content="Online konvertierung umwandlung vom Telefonbuch der Fritzbox (.xml Datei) : zwischen .xml â†” von / nach .vcf (vcard) und zurÃ¼ck." />
<meta property="og:type" content="webapp" />
<!--
<link rel="icon" href="img/icon_convert_formats.png" sizes="141x96" />
<link rel="apple-touch-icon" href="img/icon_convert_formats.png" sizes="141x96" />
-->
<meta property="og:url" lang="de" content="https://soerenj.github.io/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html#de" />
<meta property="og:url" lang="en" content="https://soerenj.github.io/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html#en" />
<link rel="alternate" href="https://soerenj.github.io/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html#en" lang="en" hreflang="en" />
<link rel="alternate" href="https://soerenj.github.io/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html#de" lang="de" hreflang="de" />
<!-- "image": "https://soerenj.github.io/fritzbox_phonebook_convert_xml_vcf/img/icon_convert_formats.png",-->
<link rel="canonical" href="https://soerenj.codeberg.page/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html" />
<script type='application/ld+json'>
{
	"@context": "http://schema.org/",
	"@type": "WebApplication",
	"@id": "https://soerenj.codeberg.page/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html",
	"author":[{"@context":"https://schema.org", "@type":"Person", "name:":"soerenj", "url":"https://codeberg.org/soerenj/","url":"https://github.com/soerenj/"}],
	"applicationCategory": "UtilitiesApplication",
	"applicationSubCategory": "convert",
	"isAccessibleForFree": "true",
	"license": "https://www.gnu.org/licenses/agpl-3.0.txt",
	"name": "convert phonebook Fritzbox",
	"description": "convert phonebook files from router Fritzbox .xml to .vcf (vcard) and backwards",
	"programmingLanguage": "javascript",
	"dateModified": "2025-06-05",
	"softwareVersion": "0.331",
	"inLanguage": ["en", "de"],
    "mainEntityOfPage":"https://soerenj.github.io/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html",
	"url":"https://soerenj.github.io/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html",
	"SoftwareSourceCode": "https://github.com/soerenj/fritzbox_phonebook_convert_xml_vcf/",
	"isBasedOn": "https://soerenj.github.io/fritzbox_phonebook_convert_xml_csv_vcf/fritzbox_phonebook_convert.html",
	"sameAs": "https://soerenj.codeberg.page/fritzbox_phonebook_convert_xml_vcf/fritzbox_phonebook_convert_vcf.html"
}
</script>
<!--
 /*
 * version: 0.331
 * date: 2025-06-05
 *
 * Licence 
 *
 * Licence Exception:
 *   - Zip.js "Create pkZip files with javaScript" ; from: https://github.com/pwasystem/zip/ ; licence: Unlicense license
 *
 * All other parts:
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 */
  -->
<style>
input{ cursor: pointer } 
.advanced_view{ display:none; }
textarea{ min-width:500pt;width:80%;height:100pt;}
@media (min-height:800pt){ 
  textarea{ height:200pt;} }
details summary { color:LinkText;}
details summary:hover, details summary :hover, a .en:hover, a .de :hover{
  text-decoration:underline; cursor:pointer; color:#000; }
details div { margin-left: 12pt; }
a:hover span{ text-decoration:underline; }
.drop-area_highlight, .drop-area_text_highlight {
  border-color: purple; width: 90%; min-width:90%; height:90%; min-height:90%; background:rgba(64, 64, 64, 0.5); position:absolute;  top:0px; left:0px; border: 2px dashed #ccc; border-radius: 20pt; margin:5%; font-size: 3em; text-align: center;  padding-top: 25%;}
.de{ display:none; }
input#setting__xml2__phonenumber_edit_your_countrycode:invalid, input#setting__xml2__phonenumber_edit_your_areacode:invalid {
  border: medium solid red; }
.onlytouchscreen{ display:none; }
input + label {vertical-align:top; }
@media (pointer: coarse){
  body{ margin: 0.4em;}
  details > summary > span::before{ content: "â–¸"; margin-right: 0.2em; }
  details[open] > summary > span::before{ content: "â–¾"; }
  .onlytouchscreen{ display:inline; }
  input[type="button"], input[type="file"], a.maybebutton, details summary {
    display:block; padding: .4em .8em;   background: #e6e6e6;  font-size: 125%;   line-height: 1.5;  margin: 2em;  padding: .5em 1em;  border-radius: .5em;color: black;  cursor: pointer;  border: 1pt solid black; }
  input[type="file"]{ margin: 0.4em; max-width: calc(100% - 3em); } 
  a:hover, details summary:hover{  outline: none;  background: white;  color: darkblue; }
}
</style>
</head>
<body>
<header>
<!--<img src="img/icon_convert_formats.png" style="float:left;padding:6pt;" />-->
<span style="float:right"><a href="#en" onClick="changeLanguage('en')" alt="en" hreflang="en" title="change language to english">&#127468&#127463</a> <a href="#de" onClick="changeLanguage('de')" hreflang="de" alt="de" title="wechsel die Sprache zu deutsch / german">&#127465&#127466</a></span>
<h1 lang="en" class="en">Phonebook Contact convert for Fritzbox</h1>
<h1 lang="de" class="de">Telefonbuch Kontakte konvertieren fÃ¼r Fritzbox</h1>
<h2 lang="en" class="en">Converts Fritzbox .XML-Files to/from .VCF-File (vcard).</h2>
<h2 lang="de" class="de">Konvertiert Fritzbox .XML-Dateien zu/von .VCF-Dateien (vcard).</h2>
<span style="clear:both"></span><br>
</header>
<noscript style="color:red">You need JavaScript, to use this service.</noscript>

<div id="container_file-input_drag-n-drop">
<!--
<span lang="en" class="en">Select &nbsp;- or -&nbsp; drag & drop file(s): </span>
<span lang="de" class="de">AuswÃ¤hlen &nbsp;- oder -&nbsp; hier reinziehen von Datei(en) <span style="color:#999;">("drag & drop")</span>:</span>
<br />
<span style="color:#999999"><i><span lang="en" class="en">Allowed</span><span lang="de" class="de">Erlaubt</span>: Fritzbox .xml , .vcf , .vcard</i></span><br>
-->
<span id="file-input_drag-n-drop_text_drophere" style="display:none">Drop your file here</span>
<input type="file" multiple id="file-input_drag-n-drop" autocomplete="off" style="display:none" /><a href="#" id="file-input_drag-n-drop_close_button" style="display:none;background: white;  font-size: 2em;  text-align: right;  top: 10%;  position: absolute;  padding: 0.5em;  right: 10%; border-radius:20pt;" onClick="dragNDropArea_Hide();return false;" class="maybebutton">Close ðŸ—™</a><br>
</div>
<p id="container_file-input_xml">
<label for="file-input_xml" id="label_file-input_xml">
 <span lang="en" class="en">Your .xml file:</span>
 <span lang="de" class="de">Ihre .xml Datei:</span>
</label>
<input type="file" multiple id="file-input_xml" autocomplete="off" /></p>
<p id="container_f_text_or"> <span lang="en" class="en"> - or - </span><span lang="de" class="de"> - oder - </span> </p>
<p id="container_file-input_format2">
<label for="file-input_format2" id="label_file-input_format2">
 <span lang="en" class="en">Your .vcf file:</span>
 <span lang="de" class="de">Ihre .vcf Datei:</span>
</label>
<input type="file" multiple id="file-input_format2" autocomplete="off" />
</p>
<p id="container_file-input_folder" style="display:none">
<label for="file-input_format2" id="label_file-input_folder">
 <span lang="en" class="en">Your Folder <span style="color:#999">(with .vcf or .xml files)</span>:</span>
 <span lang="de" class="de">Ihr Ordner <span style="color:#999">(mit .vcf oder .xml Dateien)</span>:</span>
</label>
<input type="file" multiple id="file-input_folder" autocomplete="off" webkitdirectory />
</p>
<p>
<a href="#" onClick="toogle_folder_file_select_mode(true);return false;" id="link_file-input_folder__selectafolder" class="maybebutton">
 <span lang="en" class="en">Folder-select <small style="color:#999">(for lots of .vcf files)</small></span>
 <span lang="de" class="de">Ordner-Auswahl <small style="color:#999">(fÃ¼r vielen .vcf Dateien)</small></span>
</a>
<a href="#" onClick="toogle_folder_file_select_mode(false);return false;"  id="link_file-input_folder__backtofiles" style="display:none" class="maybebutton">
 <span lang="en" class="en">ðŸ—™ disable folder-select</span>
 <span lang="de" class="de">ðŸ—™ deaktvieren Ordner-Auswahl</span>
</a>
</p>
</br>
<br>
<div id="ready" style="display:none;margin-top:5pt;margin-left: 50pt;background: #ddd;padding: 10pt;border-radius: 5pt;">
 <span lang="en" class="en">Ready. Look in your download folder</span>
 <span lang="de" class="de">Fertig. Schauen Sie in Ihren Download-Ordner</span>
</div>

<div id="ready_note_export_to_vcf_multivcard" style="margin-top:5pt;display:none;margin-left: 50pt;background: #ddd;padding: 10pt;border-radius: 5pt;">
 <span lang="en" class="en">Please Note: <p><u>Multi-Vcard file:</u><br> This is a Multi-Vcard file. It have all contacts in one single file. Some Programs does not support this. </p><p>Alternativ: <u>Vcard-file cur / separated for each single person:</u><br> Split in <span id="ready_note_export_to_vcf_multivcard__counter_splited1">X</span> separated files. A single vcard-file for each Person. <ul><li><a href="#" onclick="convert_to_vcf(true,true);return false;">Create a .zip file with all the single Vcard files<a/></li><li><a href="#" onclick="convert_to_vcf(true);return false;">Download all the single files directly (not recommended ; lots of files)<a/></li></ul></p> Alternativ: please try this other tool: <a href="https://blog.rillke.com/fritzXML2vcard/">https://blog.rillke.com/fritzXML2vcard/</a></span>
 <span lang="de" class="de">Information: <p><u>Multi-Vcard Datei:</u><br> Dies ist eine Multi-Vcard Datei, die erstellt wurde. Sie enthÃ¤lt alle Kontakte in einer Datei. Manche Programme unterstÃ¼tzen dies nicht. </p><p>Alternativ: <u>Vcard-Dateie aufgespalten fÃ¼r jeden einzelnen Kontakt:</u><br> Aufteilen in <span id="ready_note_export_to_vcf_multivcard__counter_splited2">X</span> Dateien. Je Person wird eine einzelne Vcard-Datei erstellt. <ul><li><a href="#" onclick="convert_to_vcf(true,true);return false;">Erstelle eine .zip Datei mit allen einzel VCard-Dateien<a/></li><li> <a href="#" onclick="convert_to_vcf(true);return false;">Download alle Einzel-Dateien direkt (nicht empfohlen ; viele Dateien)<a/></li></ul> </p>Alternativ: Bitte eine anderes Tool verwenden: z.B.: <a href="https://blog.rillke.com/fritzXML2vcard/">https://blog.rillke.com/fritzXML2vcard/</a></span>
</div>
<div id="ready_note_export_to_vcf_allversions" style="margin-top:5pt;display:none;margin-left: 50pt;background: #ddd;padding: 10pt;border-radius: 5pt;">
 <span lang="en" class="en">Please Note: <p><u>VCard Versions</u>:<br>There were three files created. There have different vcard Version: v2.1 , v3.0 , v4.0. Which file you need may depends on your target.</p></span>
 <span lang="de" class="de">Information: <p><u>VCard Versionen</u>:<br>Es wurden drei Dateien erstellt. Es sind verschiedene vcard Versionen: v2.1 , v3.0 , v4.0. Welche Datei Sie benÃ¶tigen, kommt auf ihr Ziel-Programm an.</p></span>
</div>

<p id="show_advanced_view_link_link_close" style="display:none">
<a href="#" onclick="show_advanced_view('hide');return false" class="maybebutton">
    <span lang="en" class="en">&blacktriangledown; &nbsp; close text source window ðŸ—™</span>
    <span lang="de" class="de">&blacktriangledown; &nbsp; schlieÃŸe Text-Fenster ðŸ—™</span>
</a>
</p>
<p id="show_advanced_view_link_wrapper">
  <a href="#" onclick="show_advanced_view('show');return false" class="maybebutton">
    <span lang="en" class="en">&blacktriangleright; &nbsp; show text source window</span>
    <span lang="de" class="de">&blacktriangleright; &nbsp; Text-Fenster anzeigen </span>
  </a>
</p>

<div id="select_file_xml_div" class="advanced_view">
<label for="phonebook_xml">From Fritzbox .XML File:</label><br>
<textarea id="phonebook_xml" autocomplete="off">
<?xml version="1.0" encoding="utf-8"?>
<phonebooks>
<phonebook owner="" name="phonebook1">
<contact>
<category>0</category>
<person><realName>Person A</realName></person>
<telephony nid="1"><number type="mobile" prio="1" id="0" quickdial="1" vanity="01">0176123456789</number></telephony>
<services /><setup />
<features doorphone="0" /><mod_time>1535972380</mod_time><uniqueid>227</uniqueid>
</contact>
<contact>
<category>0</category>
<person><realName>Person B</realName></person>
<telephony nid="1"><number type="mobile" prio="1" id="0">+49176987654321</number></telephony>
<services nid="1"><email classifier="private" id="0">test@example.com</email></services><setup />
<features doorphone="0" /><mod_time>1535972450</mod_time><uniqueid>229</uniqueid>
</contact>
</phonebook>
</phonebooks>
</textarea>
</div>

<!-- â†“â†‘ â‡“â‡‘ â‡©â‡§ âŸ± âŸ° â¬†â¬‡ -->
<div class="advanced_view">
 <br>
 <input type="button" value="convert: â¬‡ xml to vcf (vcard)" onclick="convert_to_vcf()" />  &nbsp;
 <input type="button" value="Download" title="Download one file" onclick="download_one_file_ask()" />   &nbsp; 
 <input type="button" value="Reset to Test-Values" title="reset to default" onclick="reset_to_default()" />   &nbsp;  
</div>

<div id="select_file_vcf_div" class="advanced_view">
<br>
<label for="phonebook_vcf">From .VCF File:</label> <input type="button" value="convert: â‡§ vcf to xml" onclick="convert_to_xml()" />   &nbsp;  <br>
<textarea id="phonebook_vcf" autocomplete="off">BEGIN:VCARD
VERSION:4.0
N:Emil Duck
FN:Emil Duck
TEL;TYPE=WORK,VOICE:090123456789
END:VCARD
BEGIN:VCARD
VERSION:2.1
N:Maxim=20Meier
FN:Maxim=20Meier
TEL;VOICE:012667123456789
TEL;TYPE=HOME:+4990987654321
EMAIL:maxim.meier@example.com
NOTE:importantContact(fritzbox)
END:VCARD

</textarea>
</div>

<textarea id="error_logs" style="display:none" class=""></textarea>

<div>
 <details>
  <summary>
   <span lang="en" class="en" >âš™ Settings</span>
   <span lang="de" class="de">âš™ Einstellungen</span>
  </summary>
  <fieldset><legend>Settings</legend>
  <div>
  <fieldset ><legend>xml &lArr; vcf (=import to fritzbox)</legend>
    <!--<span lang="en" class="en">Phone-Number edits:</span>
    <span lang="de" class="de">Telefon-Nummer bearbeiten:</span>-->
    <p style="margin: 0pt;">

    <input type="checkbox" id="setting__2xml__phonenumber_edit_detect_mobile__active" autocomplete="off" checked/>
    <label for="setting__2xml__phonenumber_edit_detect_mobile__active">
     <span lang="en" class="en">Detect mobile phone-number (if already not set). <span style="color:#999">(to fit in the number categorie)</span></span>
     <span lang="de" class="de">Mobilfunk-Nummer automatisch erkennen (wenn noch nicht festgelegt). <span style="color:#999">(damit die Nummern Kategorie passt)</span></span>
    </label>
    <label for="setting__2xml__phonenumber_edit_detect_mobile__your_countrycode">
     <span lang="en" class="en">Therefore, set your own country:</span>
     <span lang="de" class="de">DafÃ¼r ihr Land festlegen:</span>
    </label>
    <select name="setting__2xml__phonenumber_edit_detect_mobile__your_countrycode" id="setting__2xml__phonenumber_edit_detect_mobile__your_countrycode" autocomplete="off">
      <option value="">-</value>
    </select>
    </p>
  </fieldset>
  <fieldset ><legend>xml &rArr; vcf (=export from fritzbox)</legend>
    <!--<span lang="en" class="en">Phone-Number edits:</span>
    <span lang="de" class="de">Telefon-Nummer bearbeiten:</span>-->
    <p style="margin: 0pt;">
    <input type="checkbox" id="setting__xml2__phonenumber_edit_your_countrycode__active" autocomplete="off" />
    <label for="setting__xml2__phonenumber_edit_your_countrycode__active">
     <span lang="en" class="en">Add your Telephone country codes:</span>
     <span lang="de" class="de">Ihre Land-Vorwahl hinzufÃ¼gen:</span>
    </label><!-- v(([0-9][0-9])|(\+)) -->
    <input type="text" size="8" pattern="((00)|\+)[0-9][0-9]*?" name="setting__xml2__phonenumber_edit_your_countrycode" id="setting__xml2__phonenumber_edit_your_countrycode" autocomplete="off" />
    <span lang="en" class="en" style="color:#999">(if missing) Example: +49 or 0049 for germany.</span>
    <span lang="de" class="de" style="color:#999">(wenn sie fehlt) Beispiel: +49 oder 0049 fÃ¼r Deuschland.</span>
    </p>
    <p style="margin: 0pt;">
    <input type="checkbox" id="setting__xml2__phonenumber_edit_your_areacode__active" autocomplete="off" />
    <label for="setting__xml2__phonenumber_edit_your_areacode__active">
     <span lang="en" class="en">Add your local Area (City/Town) code:</span>
     <span lang="de" class="de">Ihre lokale Stadt/Orts-Vorwahl hinzufÃ¼gen:</span>
    </label><!-- v(([0-9][0-9])|(\+)) -->
    <input type="text" size="8" pattern="0[1-9][0-9].*?" name="setting__xml2__phonenumber_edit_your_areacode" id="setting__xml2__phonenumber_edit_your_areacode" autocomplete="off" />
    <span lang="en" class="en" style="color:#999">(if missing) Example: 030 for City Berlin in Germany.</span>
    <span lang="de" class="de" style="color:#999">(wenn sie fehlt) Beispiel: 030 fÃ¼r die Stadt Berlin.</span>
    </p>
  <hr>
    <p style="margin: 0pt;">
    <script language="javascript">
    function settings_ui_toggleVcfAllV(show){
      document.getElementById('set_vcf_only_for2.1').style.display='block';
      if(show){
        document.getElementById('setting__xml2vcf__version__container').style.display='none';
        if(show_advanced_view__state) var e=document.getElementsByClassName('no_for_textfields');
      }else{
        document.getElementById('setting__xml2vcf__version__container').style.display='block'; if(document.getElementById('setting__xml2vcf__version').value!='2.1') document.getElementById('set_vcf_only_for2.1').style.display='none';
      }
    }
    </script>
    <input type="checkbox" id="setting__xml2vcf__allversions" autocomplete="off" checked onChange="settings_ui_toggleVcfAllV(this.checked)"/>
    <label for="setting__xml2vcf__allversions">
      <span lang="en" class="en">Convert to all VCard-Versions at the same time (=you get three files)<!-- <span style="color:#999">(only for uploaded files. That means: not for the Textarea / <em>text source window<em> view)</span>--></span>
      <span lang="de" class="de">Konvertiere in alle VCard-Versionen gleichzeitig (=Sie erhalten drei verschiedene Dateien)<!--<span style="color:#999">(nur fÃ¼r hochgeladene Dateien. Also nicht fÃ¼r die Textarea / <em>Text-Fenster</em> Ansicht)</span>--></span>
    </label><br/>
    <span id="setting__xml2vcf__version__container" style="display:none;">
    <label for="setting__xml2vcf__version">VCard Version:</label>
    <select name="setting__xml2vcf__version" id="setting__xml2vcf__version" autocomplete="off" onChange="if(this.value=='2.1')document.getElementById('set_vcf_only_for2.1').style.display='block';else document.getElementById('set_vcf_only_for2.1').style.display='none';">
      <option value="2.1" selected>v2.1</option>
      <option value="3.0">v3.0</option>
      <option value="4.0">v4.0</option>
    </select>
    </span>
    <fieldset id="set_vcf_only_for2.1" style="display:block">
    <legend>
      <span lang="en" class="en">Improve data of file-version v2.1: (no changes needed here)</span>
      <span lang="de" class="de">Verbessere die Daten von Datei-Version v2.1: (keine Ã„nderungen nÃ¶tig)</span>
    </legend>
    <input type="checkbox" id="setting__xml2vcf__uri_encode" autocomplete="off" checked />
    <label for="setting__xml2vcf__uri_encode">
      <span lang="en" class="en">URI-Encoding for name, email. (maybe helpfull for Special Characters, <em>German: Umlauten</em>, empty spaces)</span>
      <span lang="de" class="de">URI-Encoding fÃ¼r Name, Email. (hilf evtl. bei Sonderzeichen, Umlauten, Leerzeichen)</span>
    </label><br/>
    <input type="checkbox" id="setting__xml2vcf__add_charset" autocomplete="off" checked />
    <label for="setting__xml2vcf__add_charset">
      <span lang="en" class="en">Add to String charset:UTF-8</span>
      <span lang="de" class="de">FÃ¼ge den Zeichensatz (EN:"Charset") zum Text hinzu</span>
    </label>
    </fieldset>
    <span lang="en" class="en">Export addational data: </span>
    <span lang="de" class="de">Exportiere diese weiteren Felder: </span>
    <input type="checkbox" id="setting__xml2vcf__also_phonetype" checked autocomplete="off" />
    <label for="setting__xml2vcf__also_phonetype">
      <span lang="en" class="en">phone-type (mobile,work,...)</span>
      <span lang="de" class="de">Telefon-Type (mobile,work,...)</span>
    </label> &nbsp;
    <input type="checkbox" id="setting__xml2vcf__also_prio" checked autocomplete="off" />
    <label for="setting__xml2vcf__also_prio">
      <span lang="en" class="en">marked Note for important Person (=just a note)</span>
      <span lang="de" class="de">markierung als wichtige Person(nur eine notiz)</span>
    </label> &nbsp;
    <input type="checkbox" id="setting__xml2vcf__also_email" checked autocomplete="off" />
    <label for="setting__xml2vcf__also_prio">
      <span lang="en" class="en">Email</span>
      <span lang="de" class="de">Email</span>
    </label>
    </p>
    <fieldset>
      <legend>
          <span lang="en" class="en">splited (=separated single Vcard) : </span>
    <span lang="de" class="de">geteilte (in je person vcard dateien) : </span>
    
      </legend>
    <span lang="en" class="en" style="color:#999">(splited single vcard have for each single contact a single .vcf file) </span>
    <span lang="de" class="de" style="color:#999">(geteilte single vcard haben fÃ¼r jeden einzelne Kontakt eine einzelne .vcf Datei) </span>
    <br>
    <label for="setting__xml2vcf__splited__filename_fullname">
      <span lang="en" class="en">Name of the .vcf files:</span>
      <span lang="de" class="de">Namen der .vcf Dateien:</span>
    </label>
    <select type="select" id="setting__xml2vcf__splited__filename_fullname" autocomplete="off">
      <option value="0" selected x-translation-de="Frage spÃ¤ter: initalien oder ganz">ask later: inital or full</option>
      <option value="inital_letters">inital letters only: Ma_Mu_vCard2-1.vcf</option>
      <option value="full_name">full name: Max_Musters_vCard2-1.vcf</option>
    </select>
    </fieldset>
    </p>
  </fieldset>
  <br />
  <label for="new_phonebook_name">
    <span lang="en" class="en">Name of new Phonebook-Name: </span>
    <span lang="de" class="de">Name des Telefonbuches:</span>
  </label>
  <input type="text" value="phonebook_name" title="" id="new_phonebook_name" onchange="new_phonebook_name=this.value" autocomplete="off" /> 
  <span style="color:#999;">
    <span lang="en" class="en">That is the shown new Phonebook-Name in the Fritzbox. This is not the filename.</span>
    <span lang="de" class="de">Das ist der neue Telefonbuch-Namen in der Fritzbox selbst. Es ist nicht der Datei-Name.</span>
  </span>
  <button type="button" onClick="document.getElementById(last_uploaded_file__fieldid).dispatchEvent(new Event('change'));" id="convert_again_file" style="display:none;margin-top:10pt;margin-bottom:10pt;" value="Convert the same file again" ><span lang="en" class="en">Convert the same file(s) again</span><span lang="de" class="de">Konvertiere die gleiche Datei(en) nochmal</span></button>
  <br/><br/>
  <details>
   <summary>
      <span lang="en" class="en">unimportant setting: Select file dialog - type detection</span>
      <span lang="de" class="de">unwichtige Einstellung: Datei auswÃ¤hlen - Datei Type erkennung</span>
   </summary>
      <fieldset >
        <legend>
          <span lang="en" class="en">Select file dialog</span>
          <span lang="de" class="de">Datei auswÃ¤hlen</span>
        </legend>
        <input type="checkbox" onChange="showOnlySupportedChange(this.value)" id="setting__upload__filetype_only_accepted" checked autocomplete="off">
        <label for="setting__upload__filetype_only_accepted">
          <span lang="en" class="en">Show only supported files (.xml / .vcf / ~) <span style="color:#999">( only these are selectable in file upload window/dialog in browser )</span></span>
          <span lang="de" class="de">Zeige nur unterstÃ¼tzte Dateien (.xml / .vcf / ~) an <span style="color:#999">( nur diese sind auswÃ¤hlbar im Datei-auswÃ¤hlen Fenster im Browser )</span></span>
        </label> <br />
        <input type="checkbox" id="setting__upload__filetype_auto_detect" checked autocomplete="off">
        <label for="setting__upload__filetype_auto_detect">
          <span lang="en" class="en">Automatic detection of file-type
             <span style="color:#999"><br>(detected by file-extension .xml / .vcf /.vcard or MIME-Type ; Otherwise you will be ask)</span>
          </span>
          <span lang="de" class="de">Automatisch Datei-Type feststellen
            <span style="color:#999"><br>(festgestellt wird der Datei-Type Ã¼ber Datei-Erweiterung (=Datei-Endung) .xml / .vcf /.vcard or MIME-Type ; Ansonsten wird man gefragt)</span>
          </span>
        </label>
      </fieldset>
  </details>
  <br>
  </div>
  </fieldset>
 </details>
 
</div>

<input type="button" id="file-input_reset" style="display:none;margin-top:22pt" value="reset" onclick="reset_to_default()" />
</br>
<script language="JavaScript">
<!--
var last_uploaded_file__fieldid='file-input_drag-n-drop';
var counter_convert = 0;
var show_advanced_view__state = false;
var new_phonebook_name = 'convertedPhonebook';
var maxPhoneNumbersPerEntry = 9; //maximal Numbers on Fritzbox 7390 per each contact
var phonetypes = ["mobile","home","work","fax_work"];//on fritzbox 7390

var pre_numbers__with_country_codes__and_mobile = [
 ["de","de","+49","1[567]"],
 ["fr","fr","+33","[67]"],
 ["nl","nl","+31","6"],
 ["gb","en-gb","+44","(7[12345])|(7624)|(7[789])"],
 ["at","de-at","+43","(65[0123579])|(66[013456789])"],
 ["ch","(de-ch)|(fr-ch)|(it-ch)","+41","7[456789]"],
 ["be","(nl-be)|(fr-be)","+32","4[06789]"],
 ["lu","(de-lu)|(fr-lu)","+352","(621)|(661)|(691)"]
]; //for country language codes the order could be important (later on put the longer string)
 // escape: \ must be escaped with \ before => \\

var detected_default_langcode='';
var detected_default_langcountrycode='';
var e = document.getElementById("setting__2xml__phonenumber_edit_detect_mobile__your_countrycode");
for(i=0;i<pre_numbers__with_country_codes__and_mobile.length;i++){
 var a=pre_numbers__with_country_codes__and_mobile[i];
 var pattern = "^"+a[1];
 var option = document.createElement("option");
 var language = window.navigator.userLanguage || window.navigator.language;
 if(language.search(RegExp(pattern))>=0){
  if(detected_default_langcode.length<a[0].length){ 
    detected_default_langcode=a[0];
    detected_default_langcountrycode=a[2];
    }
 }
 option.text = a[0]+" "+a[1]+" "+a[2];
 option.value = a[2];
 e.add(option);
 if(detected_default_langcountrycode!='') document.getElementById('setting__xml2__phonenumber_edit_your_countrycode').value=detected_default_langcountrycode;
}
if(detected_default_langcountrycode!='')e.value=detected_default_langcountrycode;

if(document.getElementById('file-input_drag-n-drop').value!='' ||
   document.getElementById('file-input_xml').value!='' ||
   document.getElementById('file-input_format2').value!=''||
   document.getElementById('file-input_folder').value!='')document.getElementById('file-input_reset').style.display='block';
document.getElementById('new_phonebook_name').value=new_phonebook_name;
var file_upload__accepted_filetype = ".vcf,.xml,.vcard,.text/vcard,text/x-vcard,text/directory;profile=vCard,text/directory,application/xml,text/xml";
var file_upload__accepted_filetype__xml = ".xml,application/xml,text/xml";
var file_upload__accepted_filetype__format2 = ".vcf,.vcard,.text/vcard,text/x-vcard,text/directory;profile=vCard,text/directory";
var e = null;
e = document.getElementById('file-input_drag-n-drop'); if(e.accept!=undefined)e.accept=file_upload__accepted_filetype;
e = document.getElementById('file-input_xml'); if(e.accept!=undefined)e.accept=file_upload__accepted_filetype__xml;
e = document.getElementById('file-input_format2'); if(e.accept!=undefined)e.accept=file_upload__accepted_filetype__format2;

function toogle_folder_file_select_mode(folderMode){
 var linktext_selectafolder=document.getElementById('link_file-input_folder__selectafolder');
 var linktext_backtofiles  =document.getElementById('link_file-input_folder__backtofiles');
 if(folderMode){
  linktext_selectafolder.style.display='none';
  linktext_backtofiles.style.display='';
 }else{
  linktext_selectafolder.style.display='';
  linktext_backtofiles.style.display='none';
 }
 var e=document.getElementsByTagName('input'); //for drag'n'drop
 for(let i=0;i<e.length;i++){
   if(e[i].getAttribute('type')!='file')continue;
   if(folderMode) e[i].setAttribute('webkitdirectory','webkitdirectory');
   else           e[i].removeAttribute('webkitdirectory','');
 }
 var d=''
 if(folderMode)d='none';
 if(document.getElementById('file-input_drag-n-drop').value=='')dragNDropArea_Hide(); //old (bad): document.getElementById('container_file-input_drag-n-drop').style.display='none';

 document.getElementById('container_file-input_xml').style.display=d;
 document.getElementById('container_file-input_format2').style.display=d;
 document.getElementById('container_f_text_or').style.display=d;
 if(!folderMode)d='none'; else d='';
 document.getElementById('container_file-input_folder').style.display=d;

 if(folderMode) document.getElementById("file-input_folder").click();
}

function reset_to_default(){
 document.getElementById('phonebook_xml').value = document.getElementById('phonebook_xml').defaultValue;
 document.getElementById('phonebook_vcf').value = document.getElementById('phonebook_vcf').defaultValue;
 document.getElementById('file-input_drag-n-drop').value='';
 document.getElementById('file-input_xml').value='';
 document.getElementById('file-input_format2').value='';
 document.getElementById('file-input_folder').value='';
 document.getElementById('ready').style.display="none";
}

function showOnlySupportedChange(v){
  e = document.getElementById('file-input_drag-n-drop');if(!v) e.accept=''; else e.accept=file_upload__accepted_filetype;
  e = document.getElementById('file-input_xml');if(!v) e.accept=''; else e.accept=file_upload__accepted_filetype__xml;
  e = document.getElementById('file-input_format2');if(!v) e.accept=''; else e.accept=file_upload__accepted_filetype__format2;
}

function show_errors(logError){
 //show convert errors
 if(logError.length>0){
   if(selectedLanguage=='de') alert("Datei konvertiert. Es gab "+logError.length+" Fehler (mÃ¶glicherweise auch unrelevant).");
   else alert("File converted. There are "+logError.length+" errors (maybe not import).");
   document.getElementById('error_logs').style.display='block';
   document.getElementById('error_logs').value='Errors in these lines:\n'+logError.join("\n");
 } else {
   document.getElementById('error_logs').style.display='none';
   document.getElementById('error_logs').value='';
 }

}

function convert_to_vcf__maybe_all_vers(filename){ //=vcard
 var selfcall=true;
 if(document.getElementById('setting__xml2vcf__allversions').checked){
     document.getElementById('setting__xml2vcf__version').value="4.0";
     prepare_and_download( convert_to_vcf(), filename , 'vcf');
     document.getElementById('setting__xml2vcf__version').value="3.0";
     prepare_and_download( convert_to_vcf(), filename , 'vcf');
     document.getElementById('setting__xml2vcf__version').value="2.1";
     document.getElementById('set_vcf_only_for2.1').style.display='block';
     return convert_to_vcf();
 }else convert_to_vcf();
}

function convert_to_vcf(multipleDirectDownload=false,multipleDirectDownloadZip=false){ //=vcard
 var v = document.getElementById('setting__xml2vcf__version').value; //v=Version 2.1|3.0|4.0
 var uri_encode = document.getElementById('setting__xml2vcf__uri_encode').checked;
 var add_charset = document.getElementById('setting__xml2vcf__add_charset').checked;
 var export_also_phonetype = document.getElementById('setting__xml2vcf__also_phonetype').checked;
 var export_also_email = document.getElementById('setting__xml2vcf__also_email').checked;
 var export_also_prio = document.getElementById('setting__xml2vcf__also_prio').checked;
 var text = document.getElementById('phonebook_xml').value;
 parser = new DOMParser();
 xmlDoc = parser.parseFromString(text, "text/xml");

 if(multipleDirectDownloadZip){
   var zFilen = "converted_phonebook_vcf";
   if(foldername!='') zFilen = foldername+"_converted";
   var z = new Zip(zFilen+'_v'+v.replace(/\./,'-'));
 }

 var out, outTotal, contacts, contact, person, telephony, telefone_numbers, telefone_numbers_type, telefone_numbers_prio, phone, tmp;
 out = ''; outTotal=''; logError=[];
 var contacts = xmlDoc.getElementsByTagName("contact");
 document.getElementById('ready_note_export_to_vcf_multivcard__counter_splited1').innerText=contacts.length;
 document.getElementById('ready_note_export_to_vcf_multivcard__counter_splited2').innerText=contacts.length;
 if(multipleDirectDownload){
   var text__AskMultipleVcf="It will be created and downloaded lots of files: \ncounted: "+contacts.length+" files.\nDo you want really want continue??";
   if(selectedLanguage=="de")text__AskMultipleVcf="Es werden gleiche (sehr) vielen Dateien erstellt und runtergeladen: \n"+contacts.length+" StÃ¼ck. \nMÃ¶chten Sie fortfahren?";
   var text__AskMultipleVcf_fileName="File-Names: used the full Person Name, as filename? \n(otherwise just a few inital letters) ";
   if(selectedLanguage=="de") text__AskMultipleVcf_fileName="Datei-Namen:\nSoll der volle Person Name als Dateinamen verwendet werden? (ansonsten nur ersten beiden Anfangs-Buchstaben)";
   setting__xml2vcf__splited__filename_fullname = document.getElementById('setting__xml2vcf__splited__filename_fullname').value;
   var text__AskMultipleVcf_version="";
   if(document.getElementById('setting__xml2vcf__allversions').checked){
     text__AskMultipleVcf_version="Export will be in VCard-Version "+document.getElementById('setting__xml2vcf__version').value;
     if(selectedLanguage!="de")text__AskMultipleVcf_version+="\n(It is not possible to export in all vcard-version in this step.)";
     if(selectedLanguage=="de")text__AskMultipleVcf_version+="\n(Es ist nicht mÃ¶glich in alle Vcard-Versionen gleichzeitig zu exportieren.)";
   }
   if(!multipleDirectDownloadZip) if(!confirm(text__AskMultipleVcf) ) return ""; //multipleDirectDownload=false;
   if(setting__xml2vcf__splited__filename_fullname==0 && confirm(text__AskMultipleVcf_fileName)) setting__xml2vcf__splited__filename_fullname='full_name'; else setting__xml2vcf__splited__filename_fullname='inital_letters';
   if(text__AskMultipleVcf_version!='' && !confirm(text__AskMultipleVcf_version)) return "";
 }

 var propertyAdd = '';
 if(add_charset && v==2.1)propertyAdd = ";CHARSET=UTF-8";

 for(i=0;i<contacts.length;i++)
 {
  //check values
  if(undefined==contacts[i]){ logError.push(''); continue; }
  if(
    (undefined==contacts[i].getElementsByTagName("person")[0]) ||
    (undefined==contacts[i].getElementsByTagName("person")[0].getElementsByTagName("realName")[0].firstChild.nodeValue) ||
    (undefined==contacts[i].getElementsByTagName("telephony")[0].getElementsByTagName("number")[0].firstChild.nodeValue)
  ){ logError.push(contacts[i].innerHTML); continue; }

  out = 'BEGIN:VCARD\r\n';
  if(v=="2.1") out += 'VERSION:2.1\r\n';
  if(v=="3.0") out += 'VERSION:3.0\r\n';
  if(v=="4.0") out += 'VERSION:4.0\r\n';
  contact = contacts[i];
  person  = contact.getElementsByTagName("person")[0].getElementsByTagName("realName")[0].firstChild.nodeValue;
  telephony = contact.getElementsByTagName("telephony")[0].getElementsByTagName("number");
  
  //name
  tmp = person.replace('\r\n','');
  if(uri_encode  && v=="2.1")tmp = encodeURI(tmp).replace(/%/g,'=');
  out += 'N' +propertyAdd+":"+tmp+'\r\n';
  out += 'FN'+propertyAdd+":"+tmp+'\r\n';
  
  //phone
  for(j=0;j<telephony.length;j++){
    if(null==telephony[j].firstChild || undefined==telephony[j].firstChild.nodeValue || null==telephony[j].firstChild.nodeValue) { logError.push(person); if(telephony[j].firstChild==null)logError.push('empty number:'); logError.push(telephony[j]); continue; }
    out += "TEL";
    phone = myTrimQuotes(telephony[j].firstChild.nodeValue);
    if(document.getElementById('setting__xml2__phonenumber_edit_your_areacode__active').checked &&
      !document.getElementById('setting__xml2__phonenumber_edit_your_areacode').validity.patternMismatch ){
      var areacode__pre_phone='';
      areacode__pre_phone=document.getElementById('setting__xml2__phonenumber_edit_your_areacode').value;
      if(areacode__pre_phone.substring(0,1)=="0")areacode__pre_phone=areacode__pre_phone.substring(1);
      if(phone.substring(0,1)!="0" && areacode__pre_phone!='' && phone.match(/[2-9][0-9][0-9].*?/).length>0)phone="0"+areacode__pre_phone+phone;
    }
    if(document.getElementById('setting__xml2__phonenumber_edit_your_countrycode__active').checked &&
      !document.getElementById('setting__xml2__phonenumber_edit_your_countrycode').validity.patternMismatch ){
      var countrycode__pre_phone='';
      countrycode__pre_phone=document.getElementById('setting__xml2__phonenumber_edit_your_countrycode').value;
      if(phone.length>2 && phone.substring(0,1)!="+" && phone.substring(0,1)=="0" && phone.substring(0,2)!="00" && countrycode__pre_phone!='') phone=""+countrycode__pre_phone+""+phone.substring(1);
    }

    if( export_also_phonetype && telephony[j].getAttribute('type')!=undefined) out += ';TYPE='+telephony[j].getAttribute('type').toUpperCase()+',VOICE';
    out += ":"+phone+'\r\n';
  }
  if(export_also_prio && telephony.length>0 && telephony[0].getAttribute('prio')!='')out += "NOTE:importantContact(fritzbox)\r\n";
  
  //email
  if(export_also_email){
    services = Array();
    if(undefined==contact.getElementsByTagName("services")) { logError.push(services[j]); continue; }
    if(contact.getElementsByTagName("services").length>0)services = contact.getElementsByTagName("services")[0].getElementsByTagName("email");
    for(j=0;j<services.length;j++){
      if(undefined==services[j].firstChild.nodeValue) { logError.push(services[j]); continue; }
      tmp = services[j].firstChild.nodeValue;
      if(uri_encode  && v==2.1)tmp = encodeURI(tmp).replace(/%/g,'=');
      out += "EMAIL"+propertyAdd+":"+tmp+'\r\n';
    }
  }
  
  out += "END:VCARD\r\n";
  if(multipleDirectDownload){
    var filen=person
    if(setting__xml2vcf__splited__filename_fullname=='inital_letters') filen=filen.replace(/([^ \.;,])([^ \.;,])*/g,'$1');
    if(multipleDirectDownloadZip) z.str2zip(filen+"_vcard"+v.replace(/\./,'-')+".vcf", out, '');
    else prepare_and_download(out,filen,'vcf');
  }
  outTotal+=out;
 }
 document.getElementById('phonebook_vcf').value = outTotal;
 if(multipleDirectDownloadZip) z.makeZip();
 return out;
 //download('vcf',out);
}

/**
* handle a property of vcard
* examples:
*  input: getOrCheckProperties("Tel;TYPE=HOME,WORK", "TYPE") => output: Array("HOME","WORK")
*  input: getOrCheckProperties("Tel;TYPE=HOME,WORK;ZZZ=AAA") => output: Array("HOME","WORK","AAA")
*  input: getOrCheckProperties("Tel;TYPE=HOME,WORK", "TYPE", Array("HOME","MOBILE")) => output: "HOME"
*  input: getOrCheckProperties("Tel;VOICE:", "TYPE", Array("VOICE","MOBILE")) => output: "VOICE"
*/
function getOrCheckProperties(str,searchType,searchValueArray){
    if(searchType!=undefined)searchType=searchType.toUpperCase();
    if(searchValueArray!=undefined && searchValueArray.length>0)
      for(var i=0;i<searchValueArray.length;i++) searchValueArray[i]=searchValueArray[i].toUpperCase();
    var out = new Array();
    var firstSemicolon  = str.search(/(?<=[^:]*);(?=[^:]*:)/);
    //var lastSemicolon   = str.search(/;[^;]*:.*$/);
    //var doppelpunkt   = str.search(/(?<=;[^;]*):.*$/);
    var colon   = str.indexOf(":");
    str = str.substr(firstSemicolon,colon-firstSemicolon);
    var typesSplited = str.split(';');  //e.g. "Tel;TYPE=HOME;TYPE=WORK"
    for(var t=0;t<typesSplited.length;t++){
      if( typesSplited[t].length==0)continue;
      var g = typesSplited[t].split("=");
      if( g.length==0)continue;
      if(g.length>1){
        var type = g[0];
        if(searchType==undefined || searchType==g[0].toUpperCase()){
          var sub = g[1].split(","); //e.g. "Tel;TYPE=WORK,HOME"  //?missing: should not handle escape seq.: \,?
          if(sub.length>0){
            for(k=0;k<sub.length;k++){
                if(searchValueArray==undefined)out.push( sub[k] );
                else{
                  if(searchValueArray.indexOf(sub[k].toUpperCase())!=-1)return sub[k].toUpperCase();
                }
             }
           }
         }
       }else if(searchValueArray.indexOf(g[0].toUpperCase())!=-1)return g[0].toUpperCase(); //e.g. "TEL;VOICE:1234"
     }
     if(searchValueArray==undefined)return "";
     return out;
}

function convert_to_xml(){
  //config
 var vcf_use_which_name = 'FN'; // F or FN 

 var text__charset_unsupported="sorry. Can't handle this charset. Possible some special character are wrong. Or the file is not import-able into Fritzbox.";
 if(selectedLanguage=="de") text__charset_unsupported="sorry. Kann mit diesen Zeichensatz ('charset') nicht umgehen. MÃ¶glich dasn einige Sonderzeichen oder Umlaute falsch sind. Oder, das die ganze Datei sich nicht in die Fritzbox importieren lÃ¤sst.";
 var text = document.getElementById('phonebook_vcf').value;
 var person, email, v;
 var out = '';
 var allowedPhoneTypes = new Array('WORK','HOME','MOBILE','FAX_WORK');
 var charset_unsupported_wasShown=false;
 out += '<?xml version="1.0" encoding="utf-8"?>\n<phonebooks>\n<phonebook owner="" name="'+new_phonebook_name+'">\n';
 var contacts = text.split('BEGIN:VCARD');
 for(i=0;i<contacts.length;i++)
 {
  if(contacts[i]=='')continue;
  var c = contacts[i];
  var elements = contacts[i].split(/\r\n|\r|\n/);
  var personOut='';
  var phoneOut = '';
  var EmailOut='';
  var email_temp='';
  var email_pref='';
  var typeOut = '';
  var v = '';
  var prio=false;
  
  for(j=0;j<elements.length;j++){ //handle utf8 hex code
    var str=elements[j];
    if(str.search(/;CHARSET=UTF-8;ENCODING=QUOTED-PRINTABLE/i)>=0){
        var content = str.substr( str.indexOf(':') + 1 );
        var splited = content.split("=");
        for(var k=0;k<splited.length;k++)
          splited[k] = splited[k].replace(/;/g,""); //;;; is (mostly?) only on end of line
        var str = '';
        for(var k=0;k<splited.length;k++){
          if(splited[k].length==0)continue;
          if(splited[k].toUpperCase()=='C2' || splited[k].toUpperCase()=='C3')
          {
            var hex=splited[k]+splited[k+1];
            try{
                str+= decodeURIComponent(hex.replace(/(..)/g,'%$1'))
            }catch(e){console.log('invalid hex input: ' + hex)}
            k++;
            continue;
          }
          str+=String.fromCharCode('0x'+splited[k]);
        }
        elements[j] = str.substr(0,str.indexOf(':')+1 )+''+str;
     }
     else if( str.search(/;CHARSET=UTF-8/i)>=0){
        elements[j] = str.replace(/;CHARSET=UTF-8/i,'');
     }
     else if( str.search(/CHARSET=/i)>=0){
       if(!charset_unsupported_wasShown){ alert(text__charset_unsupported); charset_unsupported_wasShown=true; }
     }
  }
  
  for(j=0;j<elements.length;j++){
    var str = elements[j];
    if((str.substr(0,3).toUpperCase()=='FN:' || str.substr(0,3).toUpperCase()=='FN;') && vcf_use_which_name=='FN'){
        strOut = str.substr( str.indexOf(':') + 1 );
        strOut = sanitize_personname(strOut,false);
        personOut = '<person><realName>'+strOut+'</realName></person>\n';
    }
    if((str.substr(0,2).toUpperCase()=='N:' || str.substr(0,2).toUpperCase()=='N;') && vcf_use_which_name=='N'){
        strOut = str.substr( str.indexOf(':') + 1 );
        strOut = sanitize_personname(strOut,false);
        personOut = '<person><realName>'+strOut+'</realName></person>\n';
    }
    
    if(str.substr(0,3).toUpperCase()=='TEL'){
        var phone=str.substr( str.indexOf(':') + 1 );
        var type='';
        if(str.substr(0,4).toUpperCase()=='TEL;') type = getOrCheckProperties(str,"TYPE",allowedPhoneTypes);
        
        if(type=='')
          if( document.getElementById("setting__2xml__phonenumber_edit_detect_mobile__active").checked && is_this_a_mobile_phonenumber(phone)) type='mobile';
        if(type!='') typeOut='type="'+type.toLowerCase()+'"';
        phoneOut += '<number '+typeOut+' id="'+j+'">'+sanitize_personname(phone,false)+'</number>\n';
    }
    if(str.substr(0,8).toUpperCase()=='VERSION:')v=str.substr(8);
    if(str.substr(0,5).toUpperCase()=='NOTE:' && str.indexOf('importantContact(fritzbox)')>0)prio=true;
    if(str.substr(0,5).toUpperCase()=='EMAIL'){ 
      var match = str.match(/PREF=([0-9]{1,3})[;:]/i);
      var prefNewSetOrIsHigher=false;
      if(match!=null && match.length>1 && match[1]>0 && ( match[1]<email_pref || email_pref=='') ){
        prefNewSetOrIsHigher=true; email_pref=match[1]; }
      if(email_temp=='' || prefNewSetOrIsHigher) email_temp = sanitize_personname(str.substr( str.indexOf(':')+1),false);
    }
  }
  
  if(email_temp!='' && email_temp.length>3)EmailOut+='<email>'+email_temp+'</email>';

  var catNumber=0;  if(prio) catNumber = 1;
  out += '<contact>\n<category>'+catNumber+'</category>\n';
  if(prio)phoneOut=phoneOut.replace(/(<number[^>]*)(>)/,'$1 prio="1">');
  if(v==2.1)personOut = personOut.replace(/=/g,'%');
  if(v==2.1)personOut = decodeURI(personOut);
  out += personOut+'<telephony nid="'+i+'">\n' + phoneOut;
  if(EmailOut!='') EmailOut='<services>'+EmailOut+'</services>';
  out += '</telephony>\n'+EmailOut+'<setup />\n<features doorphone="0" /><mod_time></mod_time><uniqueid></uniqueid>\n</contact>\n';
 }
 out += '</phonebook>\n</phonebooks>';
 document.getElementById('phonebook_xml').value = out;
 return out;
 //download('xml',out);
}


function sanitize_personname(person,inkluding_quotes){
  person = person.replace(/^\s+|\s+$/gm,'');        //trim spaces
  //replace character & , otherwise import to fritzbox not possible
  person = person.replace(/&(?!amp;)/gm,'&amp;');
  //replace character " , otherwise import to fritzbox not possible //please dont change the order
  person = person.replace(/""/gm,"&quot;");       //handle "" (from libre office export of single " possible )
  person = person.replace(/\"/gm,"&quot;");       //handle "
  person = person.replace(/"/gm,"&quot;");        //handle "
  person = person.replace(/</gm,"&gt;");          //handle <
  person = person.replace(/>/gm,"&lt;");          //handle >
  if(inkluding_quotes==undefined || inkluding_quotes){
    var tmp = '';
    tmp= person.replace(/^"(.*)"$/gm,'$1'); //trim " (only once at beginn and end)
    if(tmp.length>0) person = tmp;
    tmp= person.replace(/^'?(.*)'?$/gm,'$1'); //trim ' (only once at beginn and end)
    if(tmp.length>0) person = tmp;
  }
  person = person.replace(/^\s+|\s+$/gm,'');        //trim spaces (again)
  return person;
}

function get_filename(filename_with_path) {
    var lin = filename_with_path.split('\\');
    var win = filename_with_path.split('/');
    if(lin.length>win.length) filename = lin[lin.length-1];
    else filename = win[lin.length-1];
    return filename;
}

function download_one_file_ask(){
  if (confirm('Download text in .xml window?')) { prepare_and_download(document.getElementById('phonebook_xml').value,'','xml'); return; }
  if (confirm('Download text in .vcf window?')) { prepare_and_download(document.getElementById('phonebook_vcf').value,'','vcf'); return; }
}
function prepare_and_download(text,filename,outType) {
  if(text==undefined || text==null || text==false || text==""){ alert("Finish. End. No Output. Nothing to output."); return;}
  if(filename == undefined || filename=='') filename='';
  if(filename=='') filename='phonebook_for_fritzbox';
  if(outType=='xml'){
   filename = filename.replace(/(\.)(vcf)$/i,'_$2');
   filename += "_converted_.xml";
  }
  if(outType=='vcf'){
   if(filename!='')filename = filename.replace(/(\.)(xml)$/i,'_$2');
   if(document.getElementById('setting__xml2vcf__allversions').checked) filename += '_v'+document.getElementById('setting__xml2vcf__version').value.replace(/\./,'-')+'_';
   filename += "_converted_."+outType;
  }
  counter_convert++;
  downloadAction(filename, text, outType);
}
function download_sourcecode(){
  var filename = '';
  var text = document.getElementsByTagName('html')[0].outerHTML;
  var filename_add = '';
  if (typeof document.querySelector !== "undefined") { 
      var jsonld = JSON.parse(document.querySelector('script[type="application/ld+json"]').innerText);
      if (typeof jsonld !== "undefined" && jsonld.softwareVersion !== "undefined" && jsonld.dateModified !== "undefined" ) filename_add = " v"+jsonld.softwareVersion.replace(/\./,'-')+" "+jsonld.dateModified.replace(/\./,'-');
  }
  filename = 'converter phonebook fritzboxxml vcf vcard '+filename_add+'.html';
  text="<!DOCTYPE html>"+text;
  downloadAction(filename,text,'html');
}
function downloadAction(filename, text, outType) {
  if(text==undefined || text=="undefined" || text==false || text==""){alert("Error");return;}
  var element = document.createElement('a');
  if     (outType=='vcf') element.setAttribute('href', 'data:text/vcard;charset=utf-8,'      + encodeURIComponent(text));
  else if(outType=='xml') element.setAttribute('href', 'data:application/xml;charset=utf-8,' + encodeURIComponent(text));
  else if(outType=='html')element.setAttribute('href', 'data:text/html;charset=utf-8,'       + encodeURIComponent(text));
  else                                     element.setAttribute('href', 'data:text/plain;charset=utf-8,'      + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
  
  document.getElementById('ready').style.display="block";
  if(counter_convert%2){ document.getElementById('ready').style.border="solid 1pt black"; document.getElementById('ready').style.background='#fff'; }
  else { document.getElementById('ready').style.border=""; document.getElementById('ready').style.background='#aaa';}
  //window.setTimeout("document.getElementById('ready').style.display='none';",10000);
  document.getElementById('ready_note_export_to_vcf_multivcard').style.display='none';
  document.getElementById('ready_note_export_to_vcf_allversions').style.display='none';
    if(outType=='vcf'){
      document.getElementById('ready_note_export_to_vcf_multivcard').style.display='block';
      if(document.getElementById('setting__xml2vcf__allversions').checked)
        document.getElementById('ready_note_export_to_vcf_allversions').style.display='block';
  }
}

function myTrimQuotes(aa){
  aa = aa.replace(/^\s+|\s+$/g,''); //trim spaces
  aa = aa.replace(/^"+|"+$/g,'');   //trim "
  aa = aa.replace(/^'+|'+$/g,"");   //trim '
  aa = aa.replace(/^\s+|\s+$/g,''); //trim spaces
  return aa;
}

function is_this_a_mobile_phonenumber(phone){
  var your_default_country_code = document.getElementById("setting__2xml__phonenumber_edit_detect_mobile__your_countrycode").value;
  if(phone.length<=5)return false;
  for(i=0;i<pre_numbers__with_country_codes__and_mobile.length;i++){
    var a= pre_numbers__with_country_codes__and_mobile[i];
    var pattern = "(";
    if(your_default_country_code==a[2]) pattern+="0|";
    pattern+=a[2].replace(/\+/,"\\\\+")+"|"+a[2].replace(/\+/,"00")+")";
    pattern ="^"+pattern+"("+a[3]+")";
    if( phone.search(new RegExp(pattern))>=0)return true;
  }
  return false;
}


function check_filetype_ext(filename, ext_target){
  var filetype_by_ext = get_filetype_by_ext(filename);
  if( typeof filetype_by_ext.toLowerCase() === "undefined" ) return true;
  if( filetype_by_ext.toLowerCase()==ext_target ) return true;
  return confirm("This filename does not end with ."+ext_target+". Continue anyway?");
}

function get_filetype_by_ext(filename){
  var t = filename.split('.');
  var filetype_by_ext = '';
  if (t.length>0) filetype_by_ext = t[t.length-1];
  return filetype_by_ext;
}

function f_merge__appendfile(format,origin,add,filename){
  var text__no_entry="no entry found in the file "+filename;
  if(selectedLanguage=="de") text__no_entry="kein Eintrag gefunden in Datei "+filename;
  if(!mergeFiles)return add;
  if(format=="xml"){
     var start =add.search(/<contact/);
     if(start<=0){ alert(text__no_entry);return origin;} //=not found
     if(origin.length==0) origin=add;
     else {
       var end=add.search(/[(\r\n)|\r|\n]<\/phonebook>/);
       if(end<=0){ alert(text__no_entry);return origin;} //=not found
       origin=origin.replace(/(<\/phonebook>)/,add.substring(start,end)+"</phonebook>");
     }
  }
  if(format=="vcf"){   
    if(add.search(/BEGIN:VCARD/i)>=0) origin+=add;
    else alert(text__no_entry);
  }
  return origin;
}

var mergeFiles = false;
var files_counted = 0;
var files_counter = 0;
var foldername = '';
  
function readMultipleFiles(e) {
  //translation
  var text__file = "file";   if(selectedLanguage=="de") text__files = "Dateie";
  var text__files = "files"; if(selectedLanguage=="de") text__files = "Dateien";
  var text__found = "found";        if(selectedLanguage=="de") text__found = "gefunden";
  var text__is_this_a ="Is this a"; if(selectedLanguage=="de") text__is_this_a ="Ist das eine";
  var text__all_the="all the";      if(selectedLanguage=="de") text__all_the="alle";
  var text__unknown_filetypes = "unknow file-types"; if(selectedLanguage=="de") text__unknown_filetypes = "unbekannte Datei-Typen";
  var text__convert_the_xml_files = "Do you want convert the .xml files?";
  if(selectedLanguage=="de") text__convert_the_xml_files = "MÃ¶chte Sie die .xml Dateien umwandeln?";
  var text__these_files_were_ignored="These files were ignored";
  if(selectedLanguage=="de") text__these_files_were_ignored="Diese Dateien wurden ignoriert";
  var text__aks_about_unknown_files = "Do want to be ask, about every of this unknown files?";
  if(selectedLanguage=="de") text__aks_about_unknown_files = "MÃ¶chte Sie gefragt werden, zu jeder dieser unbekannten Datei?";
  var text__merge_to_single_phonebook="Merge to a single merged phonebook?"; //\n(only with the same file-format possible)
  if(selectedLanguage=="de")text__merge_to_single_phonebook="ZusammenfÃ¼gen zu einen einzelnen Telefonbuch?";
  //inactiv:changedToAskLaterForZip //var text__export_as_zip="Export as splited separated VCard for each single Person. And put them all in a .zip file?";
  //inactiv:changedToAskLaterForZip //if(selectedLanguage=="de") text__export_as_zip="Exportiere als geteilte einzel VCard fÃ¼r jede einzelne Person. Und diese dann in eine .zip Datei?";
  
  var counterFiletypes = Array();
  counterFiletypes["xml"]   = 0;
  counterFiletypes["vcf"]   = 0;
  counterFiletypes["other"] = 0;
  //inactiv:changedToAskLaterForZip //export_as_zip=false;
  mergeFiles=false;
  files_counter = 0;
  document.getElementById('file-input_reset').style.display='block';
  var files = e.target.files;
  if (!files || files.length==0) {
    return;
  }
  document.getElementById('convert_again_file').style.display='block';
  if(files.length>1 && confirm(text__merge_to_single_phonebook)) mergeFiles=true;
  files_counted = files.length;
  
  //first precheck all files.
  // In case of multiple selected files with different files-types.
  var ignoredFiles = '';
  var unknownFiles = '';
  for(i=0;i<files.length;i++){
    var file = files[i];
    var reader = new FileReader();
    reader.fileName = file.name;
    var filetype_by_ext = get_filetype_by_ext(reader.fileName).toLowerCase();
    if( typeof filetype_by_ext === "undefined" ) filetype_by_ext ='';
    if ( filetype_by_ext!='' || e.target.fileType!='' ){ //fileType no set at this state. ( could be deleted )
        if( filetype_by_ext=='xml' || e.target.fileType=='application/xml' || e.target.fileType=='text/xml' ) counterFiletypes["xml"]++;
        else if( filetype_by_ext=='vcf' || e.target.fileType=='text/vcard' || e.target.fileType=='text/x-vcard' || e.target.fileType=='text/directory;profile=vCard' || e.target.fileType=='text/directory' ) counterFiletypes["vcf"]++;
        else { counterFiletypes["other"]++; unknownFiles+=file.name+" , "; }
    }else { counterFiletypes["other"]++; unknownFiles+=file.name+" , "; }
  }
  var ignore_unknown_filetypes=false;
  var type_from__forced_to='';
  if(files.length>1){
      var text_a=''; 
      if(counterFiletypes["xml"]>0) text_a+=text__found+" : "+counterFiletypes["xml"]+" .xml "+text__files+".\n";
      if(counterFiletypes["vcf"]>0) text_a+=text__found+" : "+counterFiletypes["vcf"]+" .vcf "+text__files+".\n";
      if(counterFiletypes["other"]>0){
         var unkF = unknownFiles.substring(0,60);
         if(unknownFiles.length>60) unkF+=" .... (and more) ";
         if( ! confirm(text_a + text__found+ " : "+ counterFiletypes["other"] +" " + text__unknown_filetypes+": \n"+ unkF +"\n" + text__aks_about_unknown_files) ) ignore_unknown_filetypes=true;
      }
      if(counterFiletypes["xml"]>0 && counterFiletypes["vcf"]>0 && mergeFiles){  //which file-type
         if( confirm(text__convert_the_xml_files) )
         {      type_from__forced_to='xml'; ignoredFiles+=" "+text__all_the+" .vcf type "+text__files+" , "; }
         else { type_from__forced_to='vcf'; ignoredFiles+=" "+text__all_the+" .xml type "+text__files+" , "; }
      }

      //inactiv:changedToAskLaterForZip //if( type_from__forced_to=="xml" || ( type_from__forced_to=='' && counterFiletypes["xml"]>0 ) )
      //inactiv:changedToAskLaterForZip //if (confirm(text__export_as_zip))export_as_zip=true;
  }
  
  
  var counter__merged_append=0;
  foldername = '';
  for(i=0;i<files.length;i++){
      var file = files[i];
      var reader = new FileReader();
      //if(e.target.id=='file-input_drag-n-drop' || e.target.id=='file-input_xml' || e.target.id=='file-input_format2' || e.target.id=='file-input_folder'){
        last_uploaded_file__fieldid = e.target.id;
        if(e.target.id=='file-input_drag-n-drop') document.getElementById('file-input_drag-n-drop').style.display='block';
        else document.getElementById('file-input_drag-n-drop').style.display='none';
        reader.fileName = file.name;
        reader.fileType = file['type'];
        if(mergeFiles && file.webkitRelativePath!=undefined){
           var p = file.webkitRelativePath;
           foldername = p.substring(0, p.search(/[\/\\]/) );
           if(foldername=='')foldername='folder';
        } else foldername='';
        reader.onload = function(e) {
          var type_from = '';
          var contents = e.target.result;
          var filename = get_filename(e.target.fileName);
          var confirm_add=''; if(files_counted>1) confirm_add=filename+"\n";
          var filetype_by_ext = get_filetype_by_ext(filename).toLowerCase();
          if( typeof filetype_by_ext === "undefined" ) filetype_by_ext ='';
          if (document.getElementById('setting__upload__filetype_auto_detect').checked && ( filetype_by_ext!='' || e.target.fileType!='' )  ){
              if( filetype_by_ext=='xml' || e.target.fileType=='application/xml' || e.target.fileType=='text/xml' ) type_from="xml";
              if( filetype_by_ext=='vcf' || e.target.fileType=='text/vcard' || e.target.fileType=='text/x-vcard' || e.target.fileType=='text/directory;profile=vCard' || e.target.fileType=='text/directory' ) type_from="vcf";
          }
          if(type_from==''){
            if(ignore_unknown_filetypes)ignoredFiles+=" "+filename+" ,";
            else if(files_counted>1 || !document.getElementById('setting__upload__filetype_auto_detect').checked) 
            {
                //maybe ask for file-type
                if(      
                   ( type_from__forced_to=='' || type_from__forced_to=='xml' ) &&
                   confirm(confirm_add+text__is_this_a+" .xml "+text__file+"?")    ) type_from="xml";
                else if(
                   ( type_from__forced_to=='' || type_from__forced_to=='vcf' ) &&
                   confirm(confirm_add+text__is_this_a+" .vcf "+text__file+"?")    ) type_from="vcf";
                else ignoredFiles+=" "+filename+" ,";
            }
          }
          files_counter++;
     
          if(type_from!=''){

              var textfield_id = "phonebook_"+type_from;

              if(!mergeFiles){ //single file(s)
                  document.getElementById(textfield_id).value = contents;
                  if(type_from=="xml") prepare_and_download( convert_to_vcf__maybe_all_vers(filename) , filename , 'vcf');
                  if(type_from=="vcf") prepare_and_download( convert_to_xml() , filename , 'xml');
              }
              if(mergeFiles){ //append content
                if(type_from!='')
                if(type_from__forced_to=='' || type_from==type_from__forced_to){
                  if(counter__merged_append==0)  document.getElementById(textfield_id).value= '';
                  counter__merged_append++;
                  document.getElementById(textfield_id).value = f_merge__appendfile(type_from,document.getElementById(textfield_id).value,contents,filename);
                }
              }
              
          }
          if(mergeFiles){
           if(files_counted==files_counter){ //last file => start convert
              if(type_from=='')filename='';
              else filename+="_merged_";
              if(foldername!='') filename=foldername+"_merged_";
              //inactiv:changedToAskLaterForZip // inside of next if: //if(export_as_zip) convert_to_vcf(true,true); else ...prepare_and_download...
              if(type_from__forced_to=="xml" || (type_from__forced_to=='' && type_from=="xml") )
                 prepare_and_download( convert_to_vcf__maybe_all_vers(filename) , filename , 'vcf');
              if(type_from__forced_to=="vcf" || (type_from__forced_to=='' && type_from=="vcf") )
                 prepare_and_download( convert_to_xml() , filename , 'xml');
              if(ignoredFiles!='') alert(text__these_files_were_ignored+": "+ignoredFiles);
            }
          }
        //};
      }//end for
      reader.readAsText(file);
  }
}

document.getElementById('file-input_drag-n-drop')
  .addEventListener('change', readMultipleFiles, false);
document.getElementById('file-input_xml')
  .addEventListener('change', readMultipleFiles, false);
document.getElementById('file-input_format2')
  .addEventListener('change', readMultipleFiles, false);
document.getElementById('file-input_folder')
  .addEventListener('change', readMultipleFiles, false);

//document.getElementById('file-input_drag-n-drop').value='';
//reset_to_default();

function show_advanced_view(state){
 var e = document.getElementsByClassName('advanced_view');
 for(i=0;i<e.length;i++){
  if(state=='show'){
   if(e[i].tagName=='div')e[i].style.display='block';
   else e[i].style.display='inline-block'; }
  if(state=='hide')e[i].style.display='';
 }
 if(state=='show'){
   show_advanced_view__state = true;
   document.getElementById("show_advanced_view_link_wrapper").style.display='none';
   document.getElementById("show_advanced_view_link_link_close").style.display='block';
   document.getElementById("file-input_reset").style.display='none';
 }
 if(state=='hide'){
   show_advanced_view__state = false;
   document.getElementById("show_advanced_view_link_wrapper").style.display='';
   document.getElementById("show_advanced_view_link_link_close").style.display='none';
   if(document.getElementById('file-input_drag-n-drop').value!='' || 
      document.getElementById('file-input_xml').value!='' || 
      document.getElementById('file-input_format2').value!=''|| 
      document.getElementById('file-input_folder').value!='') document.getElementById('file-input_reset').style.display='block';
 }
}

//drag and drop:
var dropArea = document.getElementById('file-input_drag-n-drop');
var dropArea_CloseButton = document.getElementById('file-input_drag-n-drop_close_button');
var dropAreaText = document.getElementById('file-input_drag-n-drop_text_drophere');
var dropAreaDetect = document.getElementsByTagName('body')[0];

function preventDefaults (e) {
  e.preventDefault()
  e.stopPropagation()
}

//Close Drag'n'Drop events
var escapeKeyEvent;
function dragNDropArea_CloseKeyPressEvent(e){
  if(e.key!="Escape")return;
  dragNDropArea_Hide(e);
  document.removeEventListener("keydown", dragNDropArea_CloseKeyPressEvent);
  escapeKeyEvent=undefined;
}
var dragNDropArea_CloseClickEvent;
function dragNDropArea_CloseClickEventAction(e) {
    var flyoutE = document.getElementsByClassName("drop-area_highlight")[0];
    var targetE = e.target;
    do {
      if(targetE == flyoutE) return;
      targetE = targetE.parentNode;
    } while (targetE);
    dragNDropArea_Hide(e);
    document.removeEventListener("click", dragNDropArea_CloseClickEventAction);
    dragNDropArea_CloseClickEvent=undefined;
}

function dragNDropArea_Show(e) { //show drag'n'drop field
  document.getElementById('file-input_drag-n-drop').style.display='block';
  dropArea.classList.add('drop-area_highlight');
  dropAreaText.classList.add('drop-area_text_highlight');
  dropAreaText.style.display='block';
  dropAreaText.style.marginTop='15%';
  dropAreaText.style.background='none';
  dropArea_CloseButton.style.display='block';
  if(escapeKeyEvent==undefined)
     escapeKeyEvent = document.addEventListener("keydown", dragNDropArea_CloseKeyPressEvent);
  if(dragNDropArea_CloseClickEvent==undefined)
     dragNDropArea_CloseClickEvent = document.addEventListener("click", dragNDropArea_CloseClickEventAction);
}

function dragNDropArea_Hide(e) { //hide drag'n'drop field
  dropArea.classList.remove('drop-area_highlight');
  dropAreaText.classList.remove('drop-area_text_highlight');
  dropAreaText.style.display='none';
  dropArea_CloseButton.style.display='none';
}

dropAreaDetect.addEventListener('dragenter', dragNDropArea_Show, false);
dropAreaDetect.addEventListener('dragover', dragNDropArea_Show, false);

dropAreaDetect.addEventListener('dragleave', dragNDropArea_Hide, false);
dropAreaDetect.addEventListener('drop', dragNDropArea_Hide, false);

//-->
</script>
<hr>

<!--<em style="color:#ababab;float:right;padding-right:10pt; ">file process only name & phone number</em>-->
<details>
 <summary onclick="window.scrollBy(0, 100);window.setTimeout('window.scrollBy(0, 100);',50)" title="more privacy info">
  <span lang="en" class="en">Full Data-Privacy : because directly converted inside of your Browser: no server, no cloud</span>
  <span lang="de" class="de">Voller Datenschutz : da direkt in ihrem Browser konvertiert wird: ohne Server, ohne cloud</span>
 </summary>
<div lang="en" class="en" id="sec_adv_en"><h3>Privacy</h3>You Privacy are keept: This Page works just on your computer (or offline). Your Data will stay only on your own local computer. No Cloud, no Server. It is just pure local JavaScript-Code in your Browser. <br><br>You are still unsure, using this?: My Security-Advise:<br><a name="sec_adv_en" />
<p>Option A:
  <ol>
    <li>Change to Privat-Mode <small syle="color:#999">( so called inside Firefox)</small> or Incognito-Mode <small syle="color:#999">( called name inside of e.g. Chrome,..)</small> inside your Browser and open again this page. <br>Faster: <a href="sec_adv_en">Click here</a> with right mouse-click and select <em>"open Link in new private window"</em> <span class="onlytouchscreen">/ <em>"open in new private Tab"</em> and click <em>change to Tab</em> (at bottom)</span></li>
    <li><span class="onlineoffline_state"></span> go offline (= disconnect from Internet )</li>
    <li>Convert your file</li>
    <li>Important last Step: Close <u>ALL</u> Privacy/Incognito-Mode window afterwards, to clean up the whole <em>session</em>.</li>
  </ol>
</p>
<p>
Option B (alternativ) :
 <ol>
   <li>Download this Page: 
     <ul>
      <li><a href="#" onclick="download_sourcecode();return false;">download page</a><br> or </li>
      <!--<li>alternative <a href="https://codeberg.org/soerenj/fritzbox_phonebook_convert_xml_csv_vcf/raw/branch/pages/fritzbox_phonebook_convert.html">here</a> and / or </li>-->
      <li><i>save page</i> in your Browser <i>(press hotkey <kbd>STRG</kbd>+<kbd>S</kbd> &nbsp; - or - &nbsp; e.g.: â˜° Menue File &rarr; Save Page)</i></li>
     </ul>
   </li>
   <li><span class="onlineoffline_state"></span> go offline (= disconnect from Internet ) </li>
   <li>open to your Download folder</li>
   <li>open the downloaded .html file at your computer. It should be automatically open in your browser <small syle="color:#999">(e.g. Firefox, Chrome,..)</small>.</li>
  </ol>
</p>
</div>
<div lang="de" class="de" id="sec_adv_de"><h3>Datenschutz</h3>
Diese Seite arbeitet als offline-Programm (reines JavaScript im Browser). AnonymitÃ¤t, Datenschutz ist daher gewahrt. Ihre Daten bleiben nur auf ihren Computer. Keine Cloud, kein Server. Es ist reines, lokal ausgefÃ¼hrtes JavaScript. <br>Immernoch unsicher das hier zu nutzen?: Mein Sicherheits-Ratschlag:<br><a name="sec_adv_de" />
<p>Der erste Gedanke ist: Einfach trennen vom Internet beim umwandeln der Datei und die Seite gleich wieder schlieÃŸen. Das reicht aber nicht ganze aus. Ein <em>bÃ¶ser Dienst</em> kÃ¶nnten mittels Cookies (u.Ã¤.) ihre Daten zwischenspeichern, und bei einen spÃ¤teren erneueten Aufruf (wenn Sie wieder was wandeln mÃ¶chte), ihre Daten dann absenden.<p>
<p>
Option A:
  <ol>
    <li>Wechseln in den Privat-Modus (<small style="color:#999">so heiÃŸt es in Firefox</small>) oder Inkognito-Modus <small style="color:#999">( so heiÃŸt es in z.B. Chrome,..)</small> Ihres Internet-Browser und diese Seite erneut Ã¶ffnen.<br>  Schneller: <a href="#sec_adv_de">Hier klicken</a> mit rechter Maustasten und dann auswÃ¤hlen <span class="onlytouchscreen">(oder lange drÃ¼cken bei Touchscreens)</span>: <em>"Link in neuem privaten Fenster Ã¶ffnen"</em> <span class="onlytouchscreen">/ <em>"in neuem privaten Tab Ã¶ffnen"</em> und klicken auf <em>in Tab wechsel</em> (unten)</span> </li>
    <li><span class="onlineoffline_state"></span> gehen Sie offline (= trennen Sie die Verbindung zum Internet)</li>
    <li>wandeln Sie nun Ihre Datei um</li>
    <li>Wichtiger letzter Schritt: SchlieÃŸen Sie <u>ALLE</u> ihre Privat/Inkognito-Modus Fenster dannach. Nur so kann die ganze sogenannte <i>Sitzung</i> gelÃ¶scht, also wirklich beendet werden.</li>
  </ol>
</p>
<p>
Option B (alternativ) :
  <ol>
   <li>Download dieser Internet-Seite: 
     <ul>
      <li> <a href="#" onclick="download_sourcecode();return false;">Download Seite</a><br> oder </li>
      <!--<li>alternativ <a href="https://codeberg.org/soerenj/fritzbox_phonebook_convert_xml_csv_vcf/raw/branch/pages/fritzbox_phonebook_convert.html">hier</a> und / oder </li>-->
      <li><i>Seite speichern</i> in ihren Internet-Browser wÃ¤hlen <i>(Tastenkombination <kbd>STRG</kbd>+<kbd>S</kbd> &nbsp; - oder - &nbsp; z.B.: â˜° MenÃ¼ Datei &rarr; Seite speichern)</i></li>
     </ul>
   </li>
   <li><span class="onlineoffline_state"></span> gehen Sie offline (= trennen Sie die Verbindung zum Internet) </li>
   <li>Ã¶ffnen Sie den Download Ordner</li>
   <li>Ã¶ffnen Sie die runtergeladenen .html Datei auf ihren Computer. Diese sollte sich automatisch in ihren Internet-browser <small syle="color:#999">(z.B. Firefox, Chrome,..)</small> Ã¶ffnen.</li>
  </ol>
</p>
</div>
</details>
<details style="padding-right:4pt;">
 <summary>
  <span lang="en" class="en">About this Service</span>
  <span lang="de" class="de">Ãœber diesen Dienst / Seite</small></span>
 </summary>
 <span lang="en" class="en">
 <h3>Description:</h3>
<p>This is a Web-App, or call it online convert-Service. Converted can be phonebook from or to the a Internet-Router, called name <em>Fritzbox</em>.</p>
<br />
Possible to convert:
<ul>
<li> Fritzbox <em>.xml</em> to <em>.vcf</em> / Vcard</li>
<li> <em>.vcf</em> / Vcard to Fritzbox <em>.xml</em></li>
</ul>
Other functions:
<ul>
<li> It's running in directly your browser. ( No need of installation. No server. No Cloud. Only local Programm-Code. )</li>
<li> Multiple files can be selected and merge before.</li>
<li> separated multiple .vcf files can be converted or created. These multiple files can contains just a single person / contact.
  <ul>
    <li> Separated- and Multi-VCard files: Contact-data, which are splited in multiple separated .vcf files are supported. These .vcf files contain per file only a single person / contact.<br>
      <small>(General computer knowledge: How To select multiple files on any computer system: You can select multiple files by press and hold <kbd>STRG</kbd> while file selection, or work with <kbd>â‡§ Shift</kdb> (on first and last file), or with drag'n'drop).</small>
    </li>
    <li> Reverse also possible: Convert into multiple splited .vcf files: for each single person one single .vcf file. <br> These (lots of) files can be created directly - or - put all in a .zip file.</li>
  </ul>
</li>
</ul>
 Short adress:
<ul>
  <li><a href="https://soerenj.codeberg.page">https://soerenj.codeberg.page</a></li>
  <li><a href="https://soerenj.github.io">https://soerenj.github.io</a></li>
</ul>
</span>
<span lang="de" class="de">
 <h3>Beschreibung:</h3>
<p>Dies ist eine Web-App, oder nenne es online konvertier Dienst. Umgewandelt werden kÃ¶nnen TelefonbÃ¼cher vom oder zu diesen Internet-Router, der <em>Fritzbox</em> genannt wird.</p>
<br />
MÃ¶glich umzuwandeln ist:
<ul>
<li> Fritzbox <em>.xml</em> zu <em>.vcf</em> / Vcard</li>
<li> <em>.vcf</em> / Vcard zu Fritzbox <em>.xml</em></li>
</ul>

Weitere Funktionen:
<ul>
<li> Mehrere Dateien auswÃ¤hlen und vorher zusammenfÃ¼gen lassen: .vcf Dateien kÃ¶nnen vorher zusammengefÃ¼gt werden. (beim Datei auswÃ¤hlen <kbd>STRG</kbd> gedrÃ¼ckt halten oder per <kbd>â‡§ Shift<small>(auch Umschalttaste genannt)</small></kbd>)</li>
<li> Es lÃ¤uft direkt im Browser.  ( Es ist keine Installtion nÃ¶tig. Kein Server. Keine Cloud. Nur lokal ausgefÃ¼hrter Programmcode. )</li>
<li> Getrennt- und Multi-VCard dateien: Kontakt-daten, die auf mehrere einzelne (getrennte) .vcf Dateien aufgeteilt sind, werden auch unterstÃ¼tzt (zum konvertieren oder zum erstellen). Diese .vcf Dateien enthalten je Datei nur eine einzelne Person / Kontakt.
  <ul>
    <li> Mehrere .vcf Dateien kÃ¶nnen ausgewÃ¤hlt und zusammengefÃ¼gt werden (optional).<br>
      <small>(Allgemeines Computer wissen: Wie man mehrer Dateien an Computer System auswÃ¤hlt: Sie kÃ¶nnen mehrer Dateien auswÃ¤hlen Ã¼ber das drÃ¼cken und halten der Taste <kbd>STRG</kbd> beim der Datei auswahl, oder sie arbeiten mit Taste <kbd>â‡§ Shift</kdb> (auf der ersten und letzten Datei), oder mit der Funktion drag'n'drop).</small>
    </li>
    <li> Umgedreht auch mÃ¶glich: Also ein Umwandlung in viele getrennt einzel .vcf Dateien, je Person eine einzelne Datei. <br> Diese (sehr vielen) Dateien kÃ¶nnen direkt erstellt werden - oder - in eine .zip Datei gepackt werden </li>
  </ul>
</li>
</ul>
</span>
 <h3>
   <span lang="en" class="en">Sourcecode</span>
   <span lang="de" class="de">Quellcode</span>
 </h3>
 <small lang="en" class="en">You can also report error / issue there.</small><small lang="de" class="de">Sie kÃ¶nnen dort auch Fehler melden.</small><br>
Licence: <a href="LICENSE" rel="jslicense">AGPL</a> | Version: <span id="version_out"></span> | <a href="#" onClick="download_sourcecode();return false">Download this page (without images)</a>
<ul>
<li>
Developer-Portal "codeberg": <a href="https://codeberg.org/soerenj/fritzbox_phonebook_convert_xml_vcf/">https://codeberg.org/soerenj/fritzbox_phonebook_convert_xml_vcf/</a> &nbsp; ; &nbsp; <a href="https://github.com/soerenj/fritzbox_phonebook_convert_xml_vcf/commits/master">change-Log/History</a>
</li>
<li>
Developer-Portal "github": <a href="https://github.com/soerenj/fritzbox_phonebook_convert_xml_vcf/">https://github.com/soerenj/fritzbox_phonebook_convert_xml_vcf/</a> &nbsp; ; &nbsp; <a href="https://github.com/soerenj/fritzbox_phonebook_convert_xml_vcf/commits/master">Change-Log/History</a>
</li>
</ul>
</details>
<aside>
<details style="padding-right:4pt;">
 <summary>
  <span lang="en" class="en">Links: Alternative Services / Tools</span>
  <span lang="de" class="de">Links: Alternative Dienste / Tools</span>
 </summary>
 <h3>Links to alternative Services or Tools</h3>
 <ul>
  <li>Online Web-Service: (local JavaScript inside Browser)<br/>
convert .xml to .csv (=import/export) <br/>
<a href="https://soerenj.github.io/fritzbox_phonebook_convert_xml_csv/fritzbox_phonebook_convert_csv.html">https://soerenj.github.io/fritzbox_phonebook_convert_xml_csv/fritzbox_phonebook_convert_csv.html</a> <br>
  <li>Online Web-Service: (local JavaScript inside Browser)<br/>
convert .xml to .vcf (=export) <br/>
<a href="https://blog.rillke.com/fritzXML2vcard/">https://blog.rillke.com/fritzXML2vcard/</a>  &nbsp; ; &nbsp; <a href="https://github.com/Rillke/fritzXML2vcard?tab=readme-ov-file">Sourcecode</a> <br>
<span lang="en" class="en">This Tool can export to multiple .vcf files. You can (de)-select each single contact. Or you can export single contacts (also copy & paste possible).</span>
<span lang="de" class="de">Dieses Tool kann mehrere .vcf Dateien erstellen. Man kann einzelne Kontakte auswÃ¤hlen oder auch raus-lÃ¶schen. Es ist auch der export einzelner Kontakte mÃ¶glich (auch Copy & Paste mÃ¶glich)</span>
</li>
  <li>Computer-Programm:<br/>
   <span lang="en" class="en">supports lots of file-formats</span><span lang="de" class="de">UnterstÃ¼tzt sehr viele Datei-Formate</span> (=import/export) <br/>
   <a href="https://github.com/Rillke/Contact-Conversion-Wizard">https://github.com/Rillke/Contact-Conversion-Wizard</a> (based on <a href="https://web.archive.org/web/20160408131050/http://software.nv-systems.net/ccw/download/">https://web.archive.org/web/20160408131050/http://software.nv-systems.net/ccw/download/</a> )</li>
  <li>Computer-Programm (Java ; No GUI, just a Comand Line Tool) <span lang="en" class="en">Keine Grapische OberflÃ¤che (=GUI), sonder nur als Komando-Zeilen-Progamm (="Eingabeaufforderung") verwendbar</span> (=import/export):<br/>
   .vcf (vcard) or .csv to Fritzbox .xml (=import) <br/>
   <a href="https://github.com/berkholz/vcard2fritzXML">https://github.com/berkholz/vcard2fritzXML</a> </li>
  <li>Computer-Programm (C++ ; for Windows und Linux):<br/>
  csv , vcf , xml , vcard QR-Code fÃ¼r Android &nbsp; (=import/export) <br/>
  <a href="http://www.sigvdr.de/Software/EasyKontakt/EasyKontakt.html">http://www.sigvdr.de/Software/EasyKontakt/EasyKontakt.html</a>
  <li> ... lots of other... </li>
</ul>
</details>
</aside>

<span style="color:#aaa">
<small>
<span lang="en" class="en">Drag'n'Drop possible. </span>
<span lang="de" class="de" title="(also das hier hin rein-ziehen von Datei(en))">Drag'n'Drop mÃ¶glich<!-- <small style="color:#999;">(also das hier hin rein-ziehen von Datei<em>en</em> )</small>-->.</span>
</small>
</span>

<br/>

<script language="JavaScript">

//translation text replace
var selectedLanguage=null;
var language = window.navigator.userLanguage || window.navigator.language;
var all_languages=Array('en','de');
if(window.location.hash.length>2 && all_languages.indexOf( window.location.hash.substring(1) )>=0) changeLanguage( window.location.hash.substring(1) );
else if(language.substring(0,2)=='de')changeLanguage('de');
window.addEventListener('hashchange', function(){ 
    if(window.location.hash.length>2 && all_languages.indexOf( window.location.hash.substring(1) )>=0) changeLanguage( window.location.hash.substring(1) ); 
});

function changeLanguage(newSetLang){
 selectedLanguage=newSetLang;
 var e = document.getElementsByClassName(newSetLang);
  for(i=0;i<e.length;i++){
   e[i].style.display='inline-block';
   if(e[i].tagName=="H1") e[i].style.display='block';
  }
  for(j=0;j<all_languages.length;j++){
   if(all_languages[j]==newSetLang)continue;
   var e = document.getElementsByClassName(all_languages[j]);
   for(i=0;i<e.length;i++){
    e[i].style.display='none';
   }
  }
  if(window.location.hash.length>2 && all_languages.indexOf( window.location.hash.substring(1) )>=0){
  document.documentElement.lang=newSetLang;
  document.getElementsByTagName('html')[0].setAttribute('lang',newSetLang);}
  else if(document.documentElement.lang!='') document.documentElement.lang='';
  
  var e=document.getElementById('setting__xml2vcf__splited__filename_fullname').getElementsByTagName('option');
  for(var i=0;i<e.length;i++){
   if(selectedLanguage=="de" && e[i].hasAttribute("x-translation-de")){
    if(!e[i].hasAttribute("x-translation-en"))e[i].setAttribute("x-translation-en",e[i].innerText);
    e[i].innerText = e[i].getAttribute("x-translation-de");
   }
   if(selectedLanguage=="en" && e[i].hasAttribute("x-translation-en")){
    e[i].innerText = e[i].getAttribute("x-translation-en");
   }
 }

} //end function

//Help Privacy & Help Privacy show Offline state in 
if(window.location.hash=="#sec_adv_en")document.getElementById("sec_adv_en").parentNode.open="open";
if(window.location.hash=="#sec_adv_de")document.getElementById("sec_adv_de").parentNode.open="open";
startOnlineOfflineStateReport_done=false;
function startOnlineOfflineStateReport(){
    if(window.navigator.onLine!=undefined && !startOnlineOfflineStateReport_done){
      window.addEventListener('online',  offline_note );
      window.addEventListener('offline', offline_note );
      startOnlineOfflineStateReport_done=true;
    }
}
function offline_note(){
    var text=''; var c_color='';
    if(window.navigator.onLine=='off' || window.navigator.onLine==false ){ text='&check;'; c_color='green';}
    var elems=document.getElementsByClassName('onlineoffline_state');
    for(i=0;i<elems.length;i++){
      elems[i].innerHTML=text;
      elems[i].style.color=c_color;
    }
}
if(window.navigator.onLine!=undefined && window.navigator.onLine=='offline') offline_note();

if(new FileReader==undefined)alert("Sorry, your Internet-Browser is too old. You can not use this Service :-( "); //just for old Browsers before Year ~ 2010/2013
if (typeof document.querySelector !== "undefined") { //version-info in help
  var jsonld = JSON.parse(document.querySelector('script[type="application/ld+json"]').innerText);
  if (typeof jsonld !== "undefined" && jsonld.softwareVersion !== "undefined" && jsonld.dateModified !== "undefined" ) document.getElementById('version_out').innerText = " v"+jsonld.softwareVersion+" "+jsonld.dateModified;
}
</script>
<script language="javascript" type="text/javascript">
//https://github.com/pwasystem/zip/
//https://github.com/pwasystem/zip/blob/main/zip.js
//https://raw.githubusercontent.com/pwasystem/zip/refs/heads/main/zip.js
//last commit: Jan 6, 2025
//licence: Unlicense license

class Zip {

	constructor(name) {
		this.name = name;
		this.zip = new Array();
		this.file = new Array();
		this.o = this.makeo();
	}

	dec2bin=(dec,size)=>dec.toString(2).padStart(size,'0');
	str2dec=str=>Array.from(new TextEncoder().encode(str));
	str2hex=str=>[...new TextEncoder().encode(str)].map(x=>x.toString(16).padStart(2,'0'));
	hex2buf=hex=>new Uint8Array(hex.split(' ').map(x=>parseInt(x,16)));
	bin2hex=bin=>(parseInt(bin.slice(8),2).toString(16).padStart(2,'0')+' '+parseInt(bin.slice(0,8),2).toString(16).padStart(2,'0'));

	reverse=hex=>{
		let hexArray=new Array();
		for(let i=0;i<hex.length;i=i+2)hexArray[i]=hex[i]+''+hex[i+1];
		return hexArray.filter((a)=>a).reverse().join(' ');
	}

	makeo=()=>{
		for(var a,o=[],c=0;c<256;c++){
			a=c;
			for(var f=0;f<8;f++)a=1&a?3988292384^a>>>1:a>>>1;
			o[c]=a;
		}
		return o;
	}

	crc32=r=>{
		for(var n=-1,t=0;t<r.length;t++)n=n>>>8^this.o[255&(n^r[t])];
		return this.reverse(((-1^n)>>>0).toString(16).padStart(8,'0'));
	}

	fecth2zip(filesArray,folder=''){
		filesArray.forEach(fileUrl=>{
			let resp;
			fetch(fileUrl).then(response=>{
				resp=response;
				return response.arrayBuffer();
			}).then(blob=>{
				new Response(blob).arrayBuffer().then(buffer=>{
					console.log(`File: ${fileUrl} load`);
					let uint=[...new Uint8Array(buffer)];
					uint.modTime=resp.headers.get('Last-Modified');
					uint.fileUrl=`${this.name}/${folder}${fileUrl}`;
					this.zip[fileUrl]=uint;
				});
			});
		});
	}

	str2zip(name,str,folder=''){
		let uint=[...new Uint8Array(this.str2dec(str))];
		uint.name=name;
		uint.modTime=new Date();
		uint.fileUrl=`${this.name}/${folder}${name}`;
		this.zip[name]=uint;
	}

	files2zip(files,folder=''){
		for(let i=0;i<files.length;i++){
			files[i].arrayBuffer().then(data=>{
				let uint=[...new Uint8Array(data)];
				uint.name=files[i].name;
				uint.modTime=files[i].lastModified;
				uint.fileUrl=`${this.name}/${folder}${files[i].name}`;
				this.zip[uint.fileUrl]=uint;
			});
		}
	}

	makeZip(){
		let count=0;
		let fileHeader='';
		let centralDirectoryFileHeader='';
		let directoryInit=0;
		let offSetLocalHeader='00 00 00 00';
		let zip=this.zip;
		for(const name in zip){
			let lastMod, hour, minutes, seconds, year, month, day;
			let modTime=()=>{
				lastMod=new Date(zip[name].modTime);
				hour=this.dec2bin(lastMod.getHours(),5);
				minutes=this.dec2bin(lastMod.getMinutes(),6);
				seconds=this.dec2bin(Math.round(lastMod.getSeconds()/2),5);
				year=this.dec2bin(lastMod.getFullYear()-1980,7);
				month=this.dec2bin(lastMod.getMonth()+1,4);
				day=this.dec2bin(lastMod.getDate(),5);
				return this.bin2hex(`${hour}${minutes}${seconds}`)+' '+this.bin2hex(`${year}${month}${day}`);
			}
			let crc=this.crc32(zip[name]);
			let size=this.reverse(parseInt(zip[name].length).toString(16).padStart(8,'0'));
			let nameFile=this.str2hex(zip[name].fileUrl).join(' ');
            		let nameBytes = new TextEncoder().encode(zip[name].fileUrl);
           		let nameSize = this.reverse(nameBytes.length.toString(16).padStart(4, '0'));
			let fileHeader=`50 4B 03 04 14 00 00 00 00 00 ${modTime()} ${crc} ${size} ${size} ${nameSize} 00 00 ${nameFile}`;
			let fileHeaderBuffer=this.hex2buf(fileHeader);
			directoryInit=directoryInit+fileHeaderBuffer.length+zip[name].length;
			centralDirectoryFileHeader=`${centralDirectoryFileHeader}50 4B 01 02 14 00 14 00 00 00 00 00 ${modTime()} ${crc} ${size} ${size} ${nameSize} 00 00 00 00 00 00 01 00 20 00 00 00 ${offSetLocalHeader} ${nameFile} `;
			offSetLocalHeader=this.reverse(directoryInit.toString(16).padStart(8,'0'));
			this.file.push(fileHeaderBuffer,new Uint8Array(zip[name]));
			count++;
		}
		centralDirectoryFileHeader=centralDirectoryFileHeader.trim();
		let entries=this.reverse(count.toString(16).padStart(4,'0'));
		let dirSize=this.reverse(centralDirectoryFileHeader.split(' ').length.toString(16).padStart(8,'0'));
		let dirInit=this.reverse(directoryInit.toString(16).padStart(8,'0'));
		let centralDirectory=`50 4b 05 06 00 00 00 00 ${entries} ${entries} ${dirSize} ${dirInit} 00 00`;


		this.file.push(this.hex2buf(centralDirectoryFileHeader),this.hex2buf(centralDirectory));

		let a = document.createElement('a');
		a.href = URL.createObjectURL(new Blob([...this.file],{type:'application/octet-stream'}));
		console.log(a.href)
		a.download = `${this.name}.zip`;
		a.click();
	}
}


</script>
</body></html>
